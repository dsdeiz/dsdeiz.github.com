<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>fr.ench.info &mdash; Setting Up Pianobar with lastfmsubmitd</title>
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/assets/css/monokai.css" media="screen">

    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="nanoc 3.4.3"> 
  </head>
  <body>
    <div class="header-container">
      <header class="header">
        <h1><a href="/">fr.ench.info</a></h1>
      </header>
    </div>

    <div class="main-container">
      <div class="main">
        <div class="content">
          
<h1 class="post-title">Setting Up Pianobar with lastfmsubmitd</h1>
<article>
  <small class="meta">
    Posted on <time datetime="Dec 15 2010">December 12, 2010</time>
  </small>
  <section class="post-content">
    <p><a href="http://www.pandora.com/">Pandora</a> is a really neat, free internet radio service. I am using a console client for <strong>Pandora</strong> which is <a href="https://github.com/PromyLOPh/pianobar">Pianobar</a>. It's lacking one feature that I wanted though in which it would scrobble the music it plays over to <a href="http://www.last.fm/">Last.fm</a>. Previously it did support scrobbling to <strong>Last.fm</strong> but has been <a href="https://github.com/PromyLOPh/pianobar/issues/issue/21">moved</a>. The author said you can make use an external scrobbler.</p>

<p>For my external scrobbler I've used <a href="http://www.red-bean.com/decklin/lastfmsubmitd/">lastfmsubmitd</a>. To set it up, you'll first need to have a script that would handle the events for <strong>Pianobar</strong>. You can use the <a href="https://github.com/PromyLOPh/pianobar/blob/master/contrib/eventcmd.sh">eventcmd.sh</a> script under <strong>contrib</strong> from Pianobar's source. For <strong>lastfmsubmitd</strong>, you can simply uncomment the lines from <code>songfinish</code> to <code>;;</code>. Leave the <code>scrobbler-helper ...</code> commented (or remove) since it would be replaced with <strong>lastfmsubmitd</strong>. What I have in my <code>eventcmd.sh</code> script is this:</p>
<div class="highlight"><pre><code class="language-bash">  songfinish<span class="o">)</span>
      <span class="c"># scrobble if 75% of song have been played, but only if the song hasn't</span>
      <span class="c"># been banned</span>
      <span class="k">if</span> <span class="o">[</span> -n <span class="s2">"$songDuration"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span>
              <span class="o">[</span> <span class="k">$(</span><span class="nb">echo</span> <span class="s2">"scale=4; ($songPlayed/$songDuration*100)&gt;50"</span> | bc<span class="k">)</span> -eq 1 <span class="o">]</span> <span class="o">&amp;&amp;</span>
              <span class="o">[</span> <span class="s2">"$rating"</span> -ne 2 <span class="o">]</span>; <span class="k">then</span>
        /usr/lib/lastfmsubmitd/lastfmsubmit --artist <span class="s2">"$artist"</span> --title <span class="s2">"$title"</span> --album <span class="s2">"$album"</span> --length <span class="s2">"$((songDuration/1000))"</span>
      <span class="k">fi</span>
      ;;</code></pre></div>

<p>Once you have your <code>eventcmd.sh</code> script set up, you simply need to add this in your <strong>config</strong>:</p>
<div class="highlight"><pre><code class="language-bash"><span class="nv">event_command</span> <span class="o">=</span> /path/to/eventcmd.sh</code></pre></div>

<p>Now that that's set up, you can run the lastfmsubmitd daemon. If you're on <strong>Arch Linux</strong>, you can do <code>sudo /etc/rc.d/lastfmsubmitd start</code>, then finally start <code>pianobar</code>.</p>

<p>Cheers! :D</p>
  </section>
</article>
<p><a href="http://www.pandora.com/">Pandora</a> is a really neat, free internet radio service. I am using a console client for <strong>Pandora</strong> which is <a href="https://github.com/PromyLOPh/pianobar">Pianobar</a>. It's lacking one feature that I wanted though in which it would scrobble the music it plays over to <a href="http://www.last.fm/">Last.fm</a>. Previously it did support scrobbling to <strong>Last.fm</strong> but has been <a href="https://github.com/PromyLOPh/pianobar/issues/issue/21">moved</a>. The author said you can make use an external scrobbler.</p>

<p>For my external scrobbler I've used <a href="http://www.red-bean.com/decklin/lastfmsubmitd/">lastfmsubmitd</a>. To set it up, you'll first need to have a script that would handle the events for <strong>Pianobar</strong>. You can use the <a href="https://github.com/PromyLOPh/pianobar/blob/master/contrib/eventcmd.sh">eventcmd.sh</a> script under <strong>contrib</strong> from Pianobar's source. For <strong>lastfmsubmitd</strong>, you can simply uncomment the lines from <code>songfinish</code> to <code>;;</code>. Leave the <code>scrobbler-helper ...</code> commented (or remove) since it would be replaced with <strong>lastfmsubmitd</strong>. What I have in my <code>eventcmd.sh</code> script is this:</p>
<div class="highlight"><pre><code class="language-bash">  songfinish<span class="o">)</span>
      <span class="c"># scrobble if 75% of song have been played, but only if the song hasn't</span>
      <span class="c"># been banned</span>
      <span class="k">if</span> <span class="o">[</span> -n <span class="s2">"$songDuration"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span>
              <span class="o">[</span> <span class="k">$(</span><span class="nb">echo</span> <span class="s2">"scale=4; ($songPlayed/$songDuration*100)&gt;50"</span> | bc<span class="k">)</span> -eq 1 <span class="o">]</span> <span class="o">&amp;&amp;</span>
              <span class="o">[</span> <span class="s2">"$rating"</span> -ne 2 <span class="o">]</span>; <span class="k">then</span>
        /usr/lib/lastfmsubmitd/lastfmsubmit --artist <span class="s2">"$artist"</span> --title <span class="s2">"$title"</span> --album <span class="s2">"$album"</span> --length <span class="s2">"$((songDuration/1000))"</span>
      <span class="k">fi</span>
      ;;</code></pre></div>

<p>Once you have your <code>eventcmd.sh</code> script set up, you simply need to add this in your <strong>config</strong>:</p>
<div class="highlight"><pre><code class="language-bash"><span class="nv">event_command</span> <span class="o">=</span> /path/to/eventcmd.sh</code></pre></div>

<p>Now that that's set up, you can run the lastfmsubmitd daemon. If you're on <strong>Arch Linux</strong>, you can do <code>sudo /etc/rc.d/lastfmsubmitd start</code>, then finally start <code>pianobar</code>.</p>

<p>Cheers! :D</p>

        </div>

        <aside class="sidebar">
          <section class="about-me">
            <h2 class="title">About Me</h2>
            <p>Nothing to see here.</p>
            <ul class="social">
              <li><a target="_blank" href="http://twitter.com/breadpan"><i class="icon-twitter"></i> Twitter</a></li>
              <li><a target="_blank" href="http://github.com/dsdeiz"><i class="icon-github"></i> Github</a></li>
              <li><a target="_blank" href="http://last.fm/user/dsdeiz"><i class="icon-music"></i> Lastfm</a></li>
            </ul>
          </section>
        </aside>
      </div>
    </div>

    <div class="footer-container">
      <footer class="footer">
        <section class="view-source">
          <p>View the source for this site <a target="_blank" href="https://github.com/dsdeiz/dsdeiz.github.com">here</a>.</p>
        </section>
        <section class="site-info">
          <p>Site generated with <a target="_blank" href="github.com/ddfreyne/nanoc">Nanoc</a> and hosted at <a target="_blank" href="http://github.com/">Github</a>.<br />Images hosted by <a target="_blank" href="http://db.tt/dzLS9TI4">Dropbox</a>.</p>
        </section>
      </footer>
    </div>
  </body>
</html>

